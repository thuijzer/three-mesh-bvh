var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},r=e.parcelRequire4485;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in n){var r=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,r.call(o.exports,o,o.exports),o.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){n[e]=t},e.parcelRequire4485=r);var o=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var s=(performance||Date).now(),i=s,a=0,l=n(new o.Panel("FPS","#0ff","#002")),c=n(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=n(new o.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-s,200),e>i+1e3&&(l.update(1e3*a/(e-i),100),i=e,a=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:t,setMode:r}};o.Panel=function(e,t,n){var r=1/0,o=0,s=Math.round,i=s(window.devicePixelRatio||1),a=80*i,l=48*i,c=3*i,d=2*i,u=3*i,p=15*i,f=74*i,h=30*i,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*i+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,c,d),y.fillRect(u,p,f,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u,p,f,h),{dom:m,update:function(l,w){r=Math.min(r,l),o=Math.max(o,l),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,a,p),y.fillStyle=t,y.fillText(s(l)+" "+e+" ("+s(r)+"-"+s(o)+")",c,d),y.drawImage(m,u+i,p,f-i,h,u,p,f-i,h),y.fillRect(u+f-i,p,i,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u+f-i,p,i,s((1-l/w)*h))}}};var s=r("hGT0Q"),i=r("W2bOH");const a=new((s=r("hGT0Q")).Color);class l extends s.Loader{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,n,r){const o=this,i=new s.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{t(o.parse(n))}catch(t){r?r(t):console.error(t),o.manager.itemError(e)}}),n,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(e){let t="",n=0;const r=/^ply([\s\S]*)end_header\r?\n/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);const o={comments:[],elements:[],headerLength:n,objInfo:""},s=t.split("\n");let i;function a(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<s.length;e++){let t=s[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),r=n.shift();switch(t=n.join(" "),r){case"format":o.format=n[0],o.version=n[1];break;case"comment":o.comments.push(t);break;case"element":void 0!==i&&o.elements.push(i),i={},i.name=n[0],i.count=parseInt(n[1]),i.properties=[];break;case"property":i.properties.push(a(n,p.propertyNameMapping));break;case"obj_info":o.objInfo=t;break;default:console.log("unhandled",r,n)}}return void 0!==i&&o.elements.push(i),o}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){const r=t.split(/\s+/),o={};for(let t=0;t<e.length;t++)if("list"===e[t].type){const s=[],i=n(r.shift(),e[t].countType);for(let o=0;o<i;o++)s.push(n(r.shift(),e[t].itemType));o[e[t].name]=s}else o[e[t].name]=n(r.shift(),e[t].type);return o}function o(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let o;let s="";null!==(o=/end_header\s([\s\S]*)$/.exec(e))&&(s=o[1]);const a=s.split("\n");let c=0,d=0;for(let e=0;e<a.length;e++){let o=a[e];if(o=o.trim(),""===o)continue;d>=t.elements[c].count&&(c++,d=0);const s=r(t.elements[c].properties,o);l(n,t.elements[c].name,s),d++}return i(n)}function i(e){let t=new s.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new s.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new s.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new s.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new s.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new s.Float32BufferAttribute(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function l(e,t,n){function r(e){for(let t=0,r=e.length;t<r;t++){const r=e[t];if(r in n)return r}return null}const o=r(["x","px","posx"])||"x",s=r(["y","py","posy"])||"y",i=r(["z","pz","posz"])||"z",l=r(["nx","normalx"]),c=r(["ny","normaly"]),d=r(["nz","normalz"]),u=r(["s","u","texture_u","tx"]),p=r(["t","v","texture_v","ty"]),f=r(["red","diffuse_red","r","diffuse_r"]),h=r(["green","diffuse_green","g","diffuse_g"]),m=r(["blue","diffuse_blue","b","diffuse_b"]);if("vertex"===t)e.vertices.push(n[o],n[s],n[i]),null!==l&&null!==c&&null!==d&&e.normals.push(n[l],n[c],n[d]),null!==u&&null!==p&&e.uvs.push(n[u],n[p]),null!==f&&null!==h&&null!==m&&(a.setRGB(n[f]/255,n[h]/255,n[m]/255).convertSRGBToLinear(),e.colors.push(a.r,a.g,a.b));else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function c(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function d(e,t,n,r){const o={};let s,i=0;for(let a=0;a<n.length;a++)if("list"===n[a].type){const l=[];s=c(e,t+i,n[a].countType,r);const d=s[0];i+=s[1];for(let o=0;o<d;o++)s=c(e,t+i,n[a].itemType,r),l.push(s[0]),i+=s[1];o[n[a].name]=l}else s=c(e,t+i,n[a].type,r),o[n[a].name]=s[0],i+=s[1];return[o,i]}let u;const p=this;if(e instanceof ArrayBuffer){const n=s.LoaderUtils.decodeText(new Uint8Array(e)),r=t(n);u="ascii"===r.format?o(n,r):function(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},r="binary_little_endian"===t.format,o=new DataView(e,t.headerLength);let s,a=0;for(let e=0;e<t.elements.length;e++)for(let i=0;i<t.elements[e].count;i++){s=d(o,a,t.elements[e].properties,r),a+=s[1];const i=s[0];l(n,t.elements[e].name,i)}return i(n)}(e,r)}else u=o(e,t(e));return u}}var c=r("ghLil"),d=r("aBPXg");let u,p,f,h,m,y,w,g;s.Mesh.prototype.raycast=d.acceleratedRaycast,s.BufferGeometry.prototype.computeBoundsTree=d.computeBoundsTree,s.BufferGeometry.prototype.disposeBoundsTree=d.disposeBoundsTree;let v,x=new s.Vector2;const b=new s.Raycaster,T={displayHelper:!1,helperDepth:10,displayParents:!1,strategy:d.CENTER,pointSize:.005,raycastThreshold:.005,useBVH:!0};window.addEventListener("pointermove",(e=>{if(!m)return;x.x=e.clientX/window.innerWidth*2-1,x.y=-e.clientY/window.innerHeight*2+1,b.setFromCamera(x,f);const t=window.performance.now();if(T.useBVH){v.visible=!1;const e=new s.Matrix4;e.copy(m.matrixWorld).invert(),b.ray.applyMatrix4(e);const t=b.params.Points.threshold/((m.scale.x+m.scale.y+m.scale.z)/3),n=t*t,{ray:r}=b;let o=1/0;m.geometry.boundsTree.shapecast({boundsTraverseOrder:e=>e.distanceToPoint(r.origin),intersectsBounds:(e,n,s)=>s>o?d.NOT_INTERSECTED:(e.expandByScalar(t),r.intersectsBox(e)?d.INTERSECTED:d.NOT_INTERSECTED),intersectsTriangle:e=>{if(r.distanceSqToPoint(e.a)<n){const t=r.origin.distanceTo(e.a);t<o&&(o=t,v.position.copy(e.a).applyMatrix4(m.matrixWorld),v.visible=!0)}}})}else{const e=b.intersectObject(w,!0)[0];e?(v.position.copy(e.point),v.visible=!0):v.visible=!1}const n=window.performance.now()-t;g.innerText=`${n.toFixed(2)}ms`}),!1),function(){g=document.getElementById("output"),h=new s.WebGLRenderer({antialias:!0}),h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.setClearColor(1251612,1),document.body.appendChild(h.domElement),p=new s.Scene,f=new s.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),f.position.set(3,3,3),f.far=100,f.updateProjectionMatrix(),new i.OrbitControls(f,h.domElement),u=new o,document.body.appendChild(u.dom),window.addEventListener("resize",(function(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}),!1),(new l).load("../models/point_cloud_porsche_911_1.7M_vertices/scene.ply",(e=>{e.center();const t=new s.PointsMaterial({size:T.pointSize,vertexColors:!0});w=new s.Points(e,t),w.matrixAutoUpdate=!1,p.add(w);const n=[],r=e.clone();for(let e=0,t=r.attributes.position.count;e<t;e++)n.push(e,e,e);r.setIndex(n);const o=new s.MeshBasicMaterial({color:16711680});m=new s.Mesh(r,o),console.time("computeBoundsTree"),m.geometry.computeBoundsTree({mode:T.mode}),console.timeEnd("computeBoundsTree"),y=new d.MeshBVHVisualizer(m,T.depth),p.add(y)}));const e=new s.SphereGeometry(.01,32,32),t=new s.MeshBasicMaterial({color:16776960,opacity:.9,transparent:!0});v=new s.Mesh(e,t),v.visible=!1,p.add(v);const n=new c.GUI,r=n.addFolder("helper");r.add(T,"displayHelper"),r.add(T,"displayParents").onChange((e=>{y.displayParents=e,y.update()})),r.add(T,"helperDepth",1,20,1).name("depth").onChange((e=>{y.depth=parseInt(e),y.update()})),r.open();const a=n.addFolder("points");a.add(T,"useBVH"),a.add(T,"strategy",{CENTER:d.CENTER,AVERAGE:d.AVERAGE,SAH:d.SAH}).onChange((e=>{console.time("computeBoundsTree"),m.geometry.computeBoundsTree({strategy:parseInt(e)}),console.timeEnd("computeBoundsTree"),y.update()})),a.add(T,"pointSize",.001,.01,.001),a.add(T,"raycastThreshold",.001,.01,.001),a.open()}(),function e(){requestAnimationFrame(e),w&&(w.material.size=T.pointSize,y.visible=T.displayHelper,b.params.Points.threshold=T.raycastThreshold),u.begin(),h.render(p,f),u.end()}();
//# sourceMappingURL=pointCloudIntersection.222ac2b2.js.map
